@model DungeonBuildersGuidebook.Models.TrapArchitectModel
@{
    ViewBag.Title = "Trap Architect";
}

@section PageScripts {
	<script src="@Url.Content("~/Scripts/jquery.tmpl.min.js")" type="text/javascript"></script>
	<script src="@Url.Content("~/Scripts/jquery-ui-1.8.11.min.js")" type="text/javascript"></script>
	<script type="text/javascript">
		$(document).ready(function () {

			var newTrapMarkup = "<div class='newTrap draggableTable sortableTrap' style='margin-top: 15px;'><table><tbody><tr><td id='columnOne'>Trap Base</td><td>${TrapBase}</td></tr><tr><td id='columnOne'>Trap Effects</td><td>${TrapEffects}</td></tr><tr><td id='columnOne'>Trap Damage</td><td>${TrapDamage}</td></tr></tbody></table></div>";
			$.template("newTrapTemplate", newTrapMarkup);

			$(function () {
				$(".draggableTable").draggable({
					revert: true
				});
				$(".droppableDiv").droppable({
					tolerance: "touch",
					over: function () {
						$(this).addClass("dropHover");
					},
					out: function () {
						$(this).removeClass("dropHover");
					},
				});
				$(".draggableTable, .droppableDiv").sortable({
					connectWith: ".sortableTrap"
				});
			});

			$('#refreshButton').click(function () {
				GenerateNewTrap();
			});

			$("#addNewTrap").click(function () {
				AddTrap();
			});

			$("#resetTraps").click(function () {
				$(".newTrap").remove();
				GenerateNewTrap();
			});

			function GenerateNewTrap() {
				$.ajax({
					type: "GET",
					url: "home/GenerateNewTrap",
					success: function (newTrap) {
						$("#trapBase").text(newTrap.TrapBase);
						$("#trapEffects").text(newTrap.TrapEffects);
						$("#trapDamage").text(newTrap.TrapDamage);
					}
				});
			};

			function AddTrap() {
				$.ajax({
					type: "Get",
					url: "home/GenerateNewTrap",
					success: function (newTrap) {
						$.tmpl("newTrapTemplate", newTrap).appendTo("#TrapComponents").draggable({ revert: true });
					}
				});

			};

		});
	</script>

}


<div id="refreshTraps">
	<input type="button" id="refreshButton" value="Generate New Trap" />
	<input type="button" id="addNewTrap" value="Add A New Trap" />
	<input type="button" id="resetTraps" value="Reset" />
</div>
<div id="TrapComponents">
	<div id="initialTrap" class="sortableTrap">
		<table id="assembledTrap" class="draggableTable">
			<tbody>
				<tr>
					<td id="columnOne">Trap Base</td>
					<td id="trapBase">@Model.GetTrapBase()</td>
				</tr>
				<tr>
					<td id="columnOne">Trap Effects</td>
					<td id="trapEffects">@Model.GetTrapEffects()</td>
				</tr>
				<tr>
					<td id="columnOne">Trap Damage</td>
					<td id="trapDamage">@Model.GetTrapDamage()</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
<div id="TrapBox" class="droppableDiv sortableTrap">
	<table id="trapsToKeep">
		<tbody>
			<tr>
				<td>ADD MORE TRAPS!</td>
			</tr>
		</tbody>
	</table>
</div>
